<div>
  <h1>Search</h1>
  <div class="mat-row" style="display: flex; justify-content: space-between;">
    <!-- 縣市選單 -->
    <div class="mat-col" style="flex: 1; margin-right: 10px;">
      <mat-form-field appearance="fill" class="example-form-field">
        <mat-label>縣市</mat-label>
        <mat-select
          [(ngModel)]="selectedCity"
          (selectionChange)="onCityChange($event.value)"
          placeholder="請選擇縣市"
        >
          <mat-option *ngFor="let city of cities" [value]="city">{{ city }}</mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <!-- 行政區選單 -->
    <div class="mat-col" style="flex: 1;">
      <mat-form-field appearance="fill" class="example-form-field">
        <mat-label>行政區</mat-label>
        <mat-select
          [(ngModel)]="selectedDistrict"
          (selectionChange)="onDistrictChange($event.value)"
          [disabled]="!selectedCity"
          placeholder="請選擇行政區"
        >
          <mat-option
            *ngFor="let district of filteredDistricts"
            [value]="district.zipcode"
          >
            {{ district.name }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>
  </div>

  <!-- 顯示結果 -->
  <app-display [postalCode]="selectedZipcode ? selectedZipcode : ''"></app-display>
</div>

<div>
  <button (click)="get711NearByStoreList()">取得附近 7-11 商店</button>

  <div *ngIf="errorMessage" class="error">{{ errorMessage }}</div>

  <div *ngIf="nearbyStores.length > 0">
    <h3 class="text-xl font-bold mb-4">附近的 7-11 商店</h3>
    <div *ngFor="let store of nearbyStores" class="store p-4 border border-gray-300 rounded-lg shadow-md mb-6">
      <h4 class="text-lg font-semibold">{{ store.StoreName }} ({{ store.StoreNo }})</h4>
      <p>距離: {{ store.Distance }} 公尺</p>
      <p>是否營業: {{ store.IsOperateTime ? '是' : '否' }}</p>
      <p>剩餘數量: {{ store.RemainingQty }}</p>

      <div class="food-categories mt-4">
        <h5 class="font-medium text-md mb-2">分類圖案及子分類數量</h5>
        <div class="grid grid-cols-2 gap-4">
          <!-- 顯示每個 FoodCategory 的名稱、圖片及其累計的子分類數量 -->
          <div *ngFor="let category of foodCategories" class="category border p-4 rounded-lg text-center">
            <img [src]="category.ImageUrl" alt="{{ category.Name }}" class="w-16 h-16 mx-auto mb-2"/>
            <h6 class="text-sm font-medium">{{ category.Name }}</h6>
            <p class="text-xs">子分類數量: {{ getSubCategoryTotalQty(store, category) }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>



