<div class="container mx-auto my-8 p-6 bg-white shadow-lg rounded-lg max-w-4xl">
  <!-- <ng-container>
    <h1 class="text-2xl font-bold text-center mb-6">地區查詢</h1>
    <div class="flex justify-between gap-4">

      <div class="w-full sm:w-1/2">
        <mat-form-field appearance="fill" class="w-full">
          <mat-label>縣市</mat-label>
          <mat-select
            [(ngModel)]="selectedCity"
            (selectionChange)="onCityChange($event.value)"
            placeholder="請選擇縣市"
          >
            <mat-option *ngFor="let city of cities" [value]="city">{{ city }}</mat-option>
          </mat-select>
        </mat-form-field>
      </div>

      <div class="w-full sm:w-1/2">
        <mat-form-field appearance="fill" class="w-full">
          <mat-label>行政區</mat-label>
          <mat-select
            [(ngModel)]="selectedDistrict"
            (selectionChange)="onDistrictChange($event.value)"
            [disabled]="!selectedCity"
            placeholder="請選擇行政區"
          >
            <mat-option
              *ngFor="let district of filteredDistricts"
              [value]="district.zipcode"
            >
              {{ district.name }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </div>
  </ng-container> -->

  <!-- 輸入搜尋 -->
  <ng-container class="flex flex-col items-center">
    <h1 class="text-2xl font-bold text-center mb-6">店名地址查詢</h1>
    <form (ngSubmit)="onSubmit()" class="w-full">
      <div class="flex justify-center gap-4 w-full items-center">
        <mat-icon matSuffix class="text-gray-500 flex">search</mat-icon>
        <mat-form-field class="w-full">
          <input
            matInput
            [matAutocomplete]="auto"
            [(ngModel)]="searchTerm"
            (input)="onSearch($event)"
            class="p-3 border-2 border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
            placeholder="請輸入兩個字以上之店名或地址"
            name="searchTerm"
          />
          <mat-autocomplete #auto="matAutocomplete">
            <mat-option
              *ngFor="let store of unifiedDropDownList"
              [value]="store.label + store.name + '門市'"
              class="p-2 hover:bg-blue-100 focus:bg-blue-200"
            >
              <div *ngIf="store.label === '7-11'" class="w-full h-full">
                <div class="flex flex-col">
                  <div class="font-semibold flex items-center gap-2">
                    <!-- 圖片 -->
                    <img
                      src="{{ sevenElevenIconUrl }}"
                      alt="7-Eleven Icon"
                      class="w-3 h-3"
                    />
                    <!-- 商店名稱和地址 -->
                    <div>
                      <span>{{ store.name }}門市 </span>
                      <span class="text-sm text-gray-500">{{ store.addr }}</span>
                    </div>
                  </div>
                </div>
              </div>

              <div *ngIf="store.label === '全家'" class="w-full h-full">
                <div class="flex flex-col">
                  <div class="font-semibold flex items-center gap-2">
                    <!-- 圖片 -->
                    <img
                      src="{{ familyMartIconUrl }}"
                      alt="family-mart Icon"
                      class="w-3 h-3"
                    />
                    <!-- 商店名稱和地址 -->
                    <div>
                      <span>{{ store.name }} </span>
                      <span class="text-sm text-gray-500">{{ store.addr }}</span>
                    </div>
                  </div>
                </div>
              </div>
            </mat-option>
          </mat-autocomplete>
        </mat-form-field>

        <!-- 提交按鈕 -->
        <button
          type="submit"
          mat-raised-button
          color="primary"
          class="ml-4 p-3 bg-blue-500 text-white rounded-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500"
        >
          查詢
        </button>
      </div>
    </form>
  </ng-container>
</div>

<div>
  <div *ngIf="errorMessage" class="error">{{ errorMessage }}</div>

  <div *ngIf="nearbyStores.length > 0">
    <div *ngFor="let store of nearbyStores" class="store p-4 border border-gray-300 rounded-lg shadow-md mb-6">
      <!-- 商店圖標 -->
      <div class="store-icon mr-4">
        <h2 class="text-lg font-semibold flex items-center">
          <!-- 圖片設置寬高，並與文字在同一行顯示 -->
          <img [src]="sevenElevenIconUrl" alt="Store Icon" class="object-cover mr-2" />
          {{ store.StoreName }}門市
        </h2>
      </div>
      <h3>距離: {{ store.Distance | round:2 }} 公尺</h3>
      <h3>是否營業: {{ store.IsOperateTime ? '是' : '否' }}</h3>
      <h3>剩餘數量: {{ store.RemainingQty }}</h3>

      <div class="food-categories mt-4">
        <div class="grid grid-cols-5 gap-4">
          <!-- 顯示每個 FoodCategory 的名稱、圖片及其累計的子分類數量 -->
          <div
            *ngFor="let category of foodCategories | slice:0:10; let i = index"
            class="category border p-4 rounded-lg text-center cursor-pointer"
            (click)="toggleSubCategoryDetails(store, category)"
            [class.pointer-events-none]="getSubCategoryTotalQty(store, category) === 0"
          >
            <!-- 圖片透明度調整 -->
          <img [src]="category.ImageUrl"
                  alt="{{ category.Name }}"
                  class="w-16 h-16 mx-auto mb-2 object-cover"
                  [ngStyle]="{'opacity': getSubCategoryTotalQty(store, category) === 0 ? 0.3 : 1}"/>

            <h3 class="text-sm font-medium">{{ category.Name }}</h3>
            <h4 class="text-xs">數量: {{ getSubCategoryTotalQty(store, category) }}</h4>
          </div>
        </div>

        <!-- 顯示子分類詳細內容 -->
        <div *ngIf="selectedCategory && selectedStore === store" class="sub-category-details mt-4">
          <app-display
            [store]="selectedStore"
            [category]="selectedCategory">
          </app-display>
        </div>
      </div>
    </div>
  </div>
</div>



