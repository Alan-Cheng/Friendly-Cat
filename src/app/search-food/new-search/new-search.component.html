<div class="container mx-auto my-8 p-6 bg-white shadow-lg rounded-lg max-w-4xl">
  <ng-container>
    <h1 class="text-2xl font-bold text-center mb-6">地區查詢</h1>
    <div class="flex justify-between gap-4">
      <!-- 縣市選單 -->
      <div class="w-full sm:w-1/2">
        <mat-form-field appearance="fill" class="w-full">
          <mat-label>縣市</mat-label>
          <mat-select
            [(ngModel)]="selectedCity"
            (selectionChange)="onCityChange($event.value)"
            placeholder="請選擇縣市"
          >
            <mat-option *ngFor="let city of cities" [value]="city">{{ city }}</mat-option>
          </mat-select>
        </mat-form-field>
      </div>

      <!-- 行政區選單 -->
      <div class="w-full sm:w-1/2">
        <mat-form-field appearance="fill" class="w-full">
          <mat-label>行政區</mat-label>
          <mat-select
            [(ngModel)]="selectedDistrict"
            (selectionChange)="onDistrictChange($event.value)"
            [disabled]="!selectedCity"
            placeholder="請選擇行政區"
          >
            <mat-option
              *ngFor="let district of filteredDistricts"
              [value]="district.zipcode"
            >
              {{ district.name }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </div>
  </ng-container>

<!-- 輸入搜尋 -->
  <h1 class="text-center">
    <span>商店搜尋施工中</span>
  </h1>
  <div class="search-box mt-4 text-center">
    <input type="text" class="search-input" placeholder="搜尋商店..." disabled />
    <p class="text-gray-600 mt-2">此功能正在開發中，敬請期待！</p>
  </div>
</div>

<div>
  <div *ngIf="errorMessage" class="error">{{ errorMessage }}</div>

  <div *ngIf="nearbyStores.length > 0">
    <div *ngFor="let store of nearbyStores" class="store p-4 border border-gray-300 rounded-lg shadow-md mb-6">
      <!-- 商店圖標 -->
      <div class="store-icon mr-4">
        <h2 class="text-lg font-semibold flex items-center">
          <!-- 圖片設置寬高，並與文字在同一行顯示 -->
          <img [src]="sevenElevenIconUrl" alt="Store Icon" class="object-cover mr-2" />
          {{ store.StoreName }}門市
        </h2>
      </div>
      <h3>距離: {{ store.Distance | round:2 }} 公尺</h3>
      <h3>是否營業: {{ store.IsOperateTime ? '是' : '否' }}</h3>
      <h3>剩餘數量: {{ store.RemainingQty }}</h3>

      <div class="food-categories mt-4">
        <div class="grid grid-cols-5 gap-4">
          <!-- 顯示每個 FoodCategory 的名稱、圖片及其累計的子分類數量 -->
          <div
            *ngFor="let category of foodCategories | slice:0:10; let i = index"
            class="category border p-4 rounded-lg text-center cursor-pointer"
            (click)="toggleSubCategoryDetails(store, category)"
            [class.pointer-events-none]="getSubCategoryTotalQty(store, category) === 0"
          >
            <!-- 圖片透明度調整 -->
          <img [src]="category.ImageUrl"
                  alt="{{ category.Name }}"
                  class="w-16 h-16 mx-auto mb-2 object-cover"
                  [ngStyle]="{'opacity': getSubCategoryTotalQty(store, category) === 0 ? 0.3 : 1}"/>

            <h3 class="text-sm font-medium">{{ category.Name }}</h3>
            <h4 class="text-xs">數量: {{ getSubCategoryTotalQty(store, category) }}</h4>
          </div>
        </div>

        <!-- 顯示子分類詳細內容 -->
        <div *ngIf="selectedCategory && selectedStore === store" class="sub-category-details mt-4">
          <app-display
            [store]="selectedStore"
            [category]="selectedCategory">
          </app-display>
        </div>
      </div>
    </div>
  </div>
</div>



